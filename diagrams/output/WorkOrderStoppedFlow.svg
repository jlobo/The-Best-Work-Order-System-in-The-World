<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1497px" preserveAspectRatio="none" style="width:1006px;height:1497px;" version="1.1" viewBox="0 0 1006 1497" width="1006px" zoomAndPan="magnify"><defs><filter height="300%" id="f1x3t2jmqzwo9s" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="185" x="408.75" y="28.708">Work Order Stopped</text><rect fill="#FFFFFF" height="1450.2656" style="stroke: #383838; stroke-width: 1.0;" width="306" x="473.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="569.5" y="53.02">Work Order Api</text><rect fill="#FFFFFF" height="1450.2656" style="stroke: #383838; stroke-width: 1.0;" width="120" x="875.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="878.5" y="53.02">Notification Api</text><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="359.4844" style="stroke: #383838; stroke-width: 1.0;" width="10" x="518.5" y="174.8125"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="20" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="518.5" y="619.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="518.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="528.5" y1="619.6953" y2="619.6953"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="413.4219" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="518.5" y="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="518.5" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="680.5" y2="1093.9219"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="245.1953" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="518.5" y="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="518.5" y1="1134.7266" y2="1379.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="1134.7266" y2="1379.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="528.5" y1="1379.9219" y2="1379.9219"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="372.2891" style="stroke: #383838; stroke-width: 1.0;" width="10" x="523.5" y="706.6328"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="208.9453"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="446.8984"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="740.7656"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="991.5234"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="1194.9922"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="1321.6563"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="930.5" y="417.7656"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="930.5" y="962.3906"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="930.5" y="1292.5234"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="379.6172" style="stroke: #000000; stroke-width: 2.0;" width="893.5" x="99" y="253.0781"/><rect fill="#FFFFFF" height="56.7422" style="stroke: none; stroke-width: 1.0;" width="893.5" x="99" y="309.9531"/><rect fill="#FFFFFF" height="266" style="stroke: none; stroke-width: 1.0;" width="893.5" x="99" y="366.6953"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="302.0234" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="10" y="784.8984"/><rect fill="#FFFFFF" height="69.5469" style="stroke: none; stroke-width: 1.0;" width="982.5" x="10" y="841.7734"/><rect fill="#FFFFFF" height="175.6016" style="stroke: none; stroke-width: 1.0;" width="982.5" x="10" y="911.3203"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="148.7969" style="stroke: #000000; stroke-width: 2.0;" width="525" x="467.5" y="1239.125"/><line style="stroke: #383838; stroke-width: 1.0;" x1="59" x2="59" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="59" x2="59" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="59" x2="59" y1="1093.9219" y2="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="59" x2="59" y1="1134.7266" y2="1404.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="142" x2="142" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="142" x2="142" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="142" x2="142" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="142" x2="142" y1="1093.9219" y2="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="142" x2="142" y1="1134.7266" y2="1404.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="523.5" x2="523.5" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="523.5" x2="523.5" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="523.5" x2="523.5" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="523.5" x2="523.5" y1="1093.9219" y2="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="523.5" x2="523.5" y1="1134.7266" y2="1404.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="735.5" x2="735.5" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="735.5" x2="735.5" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="735.5" x2="735.5" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="735.5" x2="735.5" y1="1093.9219" y2="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="735.5" x2="735.5" y1="1134.7266" y2="1404.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="935.5" x2="935.5" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="935.5" x2="935.5" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="935.5" x2="935.5" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="935.5" x2="935.5" y1="1093.9219" y2="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="935.5" x2="935.5" y1="1134.7266" y2="1404.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="20" y="135.3779">Supervisor</text><ellipse cx="59.5" cy="65.3828" fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M59.5,73.3828 L59.5,100.3828 M46.5,81.3828 L72.5,81.3828 M59.5,100.3828 L46.5,115.3828 M59.5,100.3828 L72.5,115.3828 " fill="none" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="73" x="20" y="1416.917">Supervisor</text><ellipse cx="59.5" cy="1430.2188" fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M59.5,1438.2188 L59.5,1465.2188 M46.5,1446.2188 L72.5,1446.2188 M59.5,1465.2188 L46.5,1480.2188 M59.5,1465.2188 L72.5,1480.2188 " fill="none" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="109" y="135.3779">Operator</text><ellipse cx="142.5" cy="65.3828" fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M142.5,73.3828 L142.5,100.3828 M129.5,81.3828 L155.5,81.3828 M142.5,100.3828 L129.5,115.3828 M142.5,100.3828 L155.5,115.3828 " fill="none" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="109" y="1416.917">Operator</text><ellipse cx="142.5" cy="1430.2188" fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M142.5,1438.2188 L142.5,1465.2188 M129.5,1446.2188 L155.5,1446.2188 M142.5,1465.2188 L129.5,1480.2188 M142.5,1465.2188 L155.5,1480.2188 " fill="none" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 2.0;"/><rect fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="88" x="477.5" y="87.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="484.5" y="107.0811">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="488" y="123.3779">Controller</text><rect fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="88" x="477.5" y="1403.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="484.5" y="1423.917">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="488" y="1440.2139">Controller</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="695.5" y="119.0811">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="695.5" y="135.3779">Repository</text><path d="M717.5,70.0859 C717.5,60.0859 735.5,60.0859 735.5,60.0859 C735.5,60.0859 753.5,60.0859 753.5,70.0859 L753.5,96.0859 C753.5,106.0859 735.5,106.0859 735.5,106.0859 C735.5,106.0859 717.5,106.0859 717.5,96.0859 L717.5,70.0859 " fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M717.5,70.0859 C717.5,80.0859 735.5,80.0859 735.5,80.0859 C735.5,80.0859 753.5,80.0859 753.5,70.0859 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="695.5" y="1416.917">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="695.5" y="1433.2139">Repository</text><path d="M717.5,1446.5156 C717.5,1436.5156 735.5,1436.5156 735.5,1436.5156 C735.5,1436.5156 753.5,1436.5156 753.5,1446.5156 L753.5,1472.5156 C753.5,1482.5156 735.5,1482.5156 735.5,1482.5156 C735.5,1482.5156 717.5,1482.5156 717.5,1472.5156 L717.5,1446.5156 " fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M717.5,1446.5156 C717.5,1456.5156 735.5,1456.5156 735.5,1456.5156 C735.5,1456.5156 753.5,1456.5156 753.5,1446.5156 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="90" x="888.5" y="87.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="895.5" y="107.0811">Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="900" y="123.3779">Controller</text><rect fill="#F8F8F8" filter="url(#f1x3t2jmqzwo9s)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="90" x="888.5" y="1403.9219"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="895.5" y="1423.917">Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="900" y="1440.2139">Controller</text><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="359.4844" style="stroke: #383838; stroke-width: 1.0;" width="10" x="518.5" y="174.8125"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="20" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="518.5" y="619.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="518.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="528.5" y1="619.6953" y2="619.6953"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="413.4219" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="518.5" y="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="518.5" y1="680.5" y2="1093.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="680.5" y2="1093.9219"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="245.1953" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="518.5" y="1134.7266"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="518.5" y1="1134.7266" y2="1379.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="528.5" y1="1134.7266" y2="1379.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="518.5" x2="528.5" y1="1379.9219" y2="1379.9219"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="372.2891" style="stroke: #383838; stroke-width: 1.0;" width="10" x="523.5" y="706.6328"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="208.9453"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="446.8984"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="740.7656"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="991.5234"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="1194.9922"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="730.5" y="1321.6563"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="930.5" y="417.7656"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="930.5" y="962.3906"/><rect fill="#FFFFFF" filter="url(#f1x3t2jmqzwo9s)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="930.5" y="1292.5234"/><polygon fill="#383838" points="506.5,170.8125,516.5,174.8125,506.5,178.8125,510.5,174.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="142.5" x2="512.5" y1="174.8125" y2="174.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="149.5" y="169.7466">ChangeStatus(newWorkOrder)</text><path d="M533,153.6797 L533,178.6797 L757,178.6797 L757,163.6797 L747,153.6797 L533,153.6797 " fill="#ECECEC" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M747,153.6797 L747,163.6797 L757,163.6797 L747,153.6797 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="539" y="170.7466">lock thread for newWorkOrder.id</text><polygon fill="#383838" points="718.5,204.9453,728.5,208.9453,718.5,212.9453,722.5,208.9453" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="724.5" y1="208.9453" y2="208.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="535.5" y="203.8794">Get(newWorkOrder.id)</text><polygon fill="#383838" points="539.5,234.0781,529.5,238.0781,539.5,242.0781,535.5,238.0781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="533.5" x2="734.5" y1="238.0781" y2="238.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="545.5" y="233.0122">currentWorkOrder</text><path d="M99,253.0781 L163,253.0781 L163,260.0781 L153,270.0781 L99,270.0781 L99,253.0781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="379.6172" style="stroke: #000000; stroke-width: 2.0;" width="893.5" x="99" y="253.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="114" y="266.145">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="178" y="265.2886">[newWorkOrder.status == "started" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="182" y="278.0933">currentWorkOrder.status == "started"]</text><polygon fill="#383838" points="153.5,297.9531,143.5,301.9531,153.5,305.9531,149.5,301.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="147.5" x2="517.5" y1="301.9531" y2="301.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="159.5" y="296.8872">[false, Error("work order has already been started")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="99" x2="992.5" y1="310.9531" y2="310.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="104" y="321.1636">[newWorkOrder.status == "started" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="269" x="108" y="333.9683">currentWorkOrder.status == "completed"]</text><polygon fill="#383838" points="153.5,354.6953,143.5,358.6953,153.5,362.6953,149.5,358.6953" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="147.5" x2="517.5" y1="358.6953" y2="358.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="159.5" y="353.6294">[false, Error("work order has already been completed")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="99" x2="992.5" y1="367.6953" y2="367.6953"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="104" y="377.9058">[newWorkOrder.status == "started"]</text><polygon fill="#383838" points="918.5,413.7656,928.5,417.7656,918.5,421.7656,922.5,417.7656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="924.5" y1="417.7656" y2="417.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="535.5" y="397.5669">Push(newWorkOrder.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="539.5" y="412.6997">newWorkOrder.status, newWorkOrder.operatorId)</text><polygon fill="#383838" points="718.5,442.8984,728.5,446.8984,718.5,450.8984,722.5,446.8984" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="724.5" y1="446.8984" y2="446.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="535.5" y="441.8325">Change(newWorkOrder)</text><polygon fill="#383838" points="539.5,472.0313,529.5,476.0313,539.5,480.0313,535.5,476.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="533.5" x2="734.5" y1="476.0313" y2="476.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="545.5" y="470.9653">ok</text><polygon fill="#383838" points="539.5,501.1641,529.5,505.1641,539.5,509.1641,535.5,505.1641" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="533.5" x2="934.5" y1="505.1641" y2="505.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="545.5" y="500.0981">ok</text><polygon fill="#383838" points="153.5,530.2969,143.5,534.2969,153.5,538.2969,149.5,534.2969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="147.5" x2="522.5" y1="534.2969" y2="534.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="159.5" y="529.231">true</text><polygon fill="#ECECEC" filter="url(#f1x3t2jmqzwo9s)" points="395,547.2969,652,547.2969,662,558.2969,652,570.2969,395,570.2969,385,558.2969,395,547.2969" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="397" y="563.3638">previousWorkOrder = currentWorkOrder</text><line style="stroke: #383838; stroke-width: 1.0;" x1="523.5" x2="570.5" y1="606.6953" y2="606.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="570.5" x2="570.5" y1="606.6953" y2="619.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="529.5" x2="570.5" y1="619.6953" y2="619.6953"/><polygon fill="#383838" points="539.5,615.6953,529.5,619.6953,539.5,623.6953,535.5,619.6953" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="535.5" y="586.4966">LaunchThreadCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="535.5" y="601.6294">(previousWorkOrder, 30)</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="428" y="663.9058">Less than 30 seconds</text><polygon fill="#383838" points="511.5,702.6328,521.5,706.6328,511.5,710.6328,515.5,706.6328" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="59.5" x2="517.5" y1="706.6328" y2="706.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="220" x="66.5" y="701.5669">ChangeStatus(stoppedWorkOrder)</text><path d="M538,685.5 L538,710.5 L789,710.5 L789,695.5 L779,685.5 L538,685.5 " fill="#ECECEC" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M779,685.5 L779,695.5 L789,695.5 L779,685.5 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="230" x="544" y="702.5669">lock thread for stoppedWorkOrder.id</text><polygon fill="#383838" points="718.5,736.7656,728.5,740.7656,718.5,744.7656,722.5,740.7656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="533.5" x2="724.5" y1="740.7656" y2="740.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="167" x="540.5" y="735.6997">Get(stoppedWorkOrder.id)</text><polygon fill="#383838" points="544.5,765.8984,534.5,769.8984,544.5,773.8984,540.5,769.8984" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="538.5" x2="734.5" y1="769.8984" y2="769.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="550.5" y="764.8325">currentWorkOrder</text><path d="M10,784.8984 L74,784.8984 L74,791.8984 L64,801.8984 L10,801.8984 L10,784.8984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="302.0234" style="stroke: #000000; stroke-width: 2.0;" width="982.5" x="10" y="784.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="25" y="797.9653">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="89" y="797.1089">[stoppedWorkOrder.status == "stopped" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="93" y="809.9136">currentWorkOrder.status != "started"]</text><polygon fill="#383838" points="70.5,829.7734,60.5,833.7734,70.5,837.7734,66.5,833.7734" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64.5" x2="522.5" y1="833.7734" y2="833.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="76.5" y="828.7075">[false, Error("work order was not started")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="992.5" y1="842.7734" y2="842.7734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="284" x="15" y="852.9839">[stoppedWorkOrder.status == "stopped" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="393" x="19" y="865.7886">(stoppedWorkOrder.operator != currentWorkOrder.operator ||</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="219" x="19" y="878.5933">!stoppedWorkOrder.isSupervisor)]</text><polygon fill="#383838" points="70.5,899.3203,60.5,903.3203,70.5,907.3203,66.5,903.3203" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64.5" x2="522.5" y1="903.3203" y2="903.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="76.5" y="898.2544">[false, Error("invalid operator")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="992.5" y1="912.3203" y2="912.3203"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="265" x="15" y="922.5308">[stoppedWorkOrder.status == "stopped"]</text><polygon fill="#383838" points="918.5,958.3906,928.5,962.3906,918.5,966.3906,922.5,962.3906" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="533.5" x2="924.5" y1="962.3906" y2="962.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="174" x="540.5" y="942.1919">push(stoppedWorkOrder.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="365" x="544.5" y="957.3247">stoppedWorkOrder.status, stoppedWorkOrder.operatorId)</text><polygon fill="#383838" points="718.5,987.5234,728.5,991.5234,718.5,995.5234,722.5,991.5234" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="533.5" x2="724.5" y1="991.5234" y2="991.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="540.5" y="986.4575">Change(stoppedWorkOrder)</text><polygon fill="#383838" points="544.5,1016.6563,534.5,1020.6563,544.5,1024.6563,540.5,1020.6563" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="538.5" x2="734.5" y1="1020.6563" y2="1020.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="550.5" y="1015.5903">ok</text><polygon fill="#383838" points="544.5,1045.7891,534.5,1049.7891,544.5,1053.7891,540.5,1049.7891" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="538.5" x2="934.5" y1="1049.7891" y2="1049.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="550.5" y="1044.7231">ok</text><polygon fill="#383838" points="70.5,1074.9219,60.5,1078.9219,70.5,1082.9219,66.5,1078.9219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="64.5" x2="517.5" y1="1078.9219" y2="1078.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="76.5" y="1073.856">true</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="443.5" y="1118.1323">After 30 seconds</text><path d="M533,1139.7266 L533,1164.7266 L786,1164.7266 L786,1149.7266 L776,1139.7266 L533,1139.7266 " fill="#ECECEC" filter="url(#f1x3t2jmqzwo9s)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M776,1139.7266 L776,1149.7266 L786,1149.7266 L776,1139.7266 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="539" y="1156.7935">lock thread for previousWorkOrder.id</text><polygon fill="#383838" points="718.5,1190.9922,728.5,1194.9922,718.5,1198.9922,722.5,1194.9922" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="724.5" y1="1194.9922" y2="1194.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="535.5" y="1189.9263">Get(previousWorkOrder.id)</text><polygon fill="#383838" points="539.5,1220.125,529.5,1224.125,539.5,1228.125,535.5,1224.125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="533.5" x2="734.5" y1="1224.125" y2="1224.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="545.5" y="1219.0591">currentWorkOrder</text><path d="M467.5,1239.125 L531.5,1239.125 L531.5,1246.125 L521.5,1256.125 L467.5,1256.125 L467.5,1239.125 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="148.7969" style="stroke: #000000; stroke-width: 2.0;" width="525" x="467.5" y="1239.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="482.5" y="1252.1919">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="546.5" y="1251.3354">[currentWorkOrder.status == "started"]</text><polygon fill="#383838" points="918.5,1288.5234,928.5,1292.5234,918.5,1296.5234,922.5,1292.5234" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="924.5" y1="1292.5234" y2="1292.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="535.5" y="1272.3247">push(previousWorkOrder.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="539.5" y="1287.4575">previousWorkOrder.status, previousWorkOrder.operatorId)</text><polygon fill="#383838" points="718.5,1317.6563,728.5,1321.6563,718.5,1325.6563,722.5,1321.6563" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="528.5" x2="724.5" y1="1321.6563" y2="1321.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="535.5" y="1316.5903">Change(previousWorkOrder)</text><polygon fill="#383838" points="539.5,1346.7891,529.5,1350.7891,539.5,1354.7891,535.5,1350.7891" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="533.5" x2="734.5" y1="1350.7891" y2="1350.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="545.5" y="1345.7231">ok</text><polygon fill="#383838" points="534.5,1375.9219,524.5,1379.9219,534.5,1383.9219,530.5,1379.9219" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="528.5" x2="934.5" y1="1379.9219" y2="1379.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="540.5" y="1374.856">ok</text><!--MD5=[dbf70ec68e1b872f67a4906c939f4c1c]
@startuml WorkOrderStoppedFlow
title Work Order Stopped
skinparam monochrome true

actor Supervisor as super
actor Operator as oper

box "Work Order Api" #Withe
participant "WorkOrder\nController" as work
database "WorkOrder\nRepository" as db
end box

box "Notification Api" #Withe
participant "Notification\nController" as noti
end box

oper -> work: ChangeStatus(newWorkOrder)
note right: lock thread for newWorkOrder.id
activate work

work -> db: Get(newWorkOrder.id)
activate db

db - -> work: currentWorkOrder
deactivate db

alt newWorkOrder.status == "started" &&\n currentWorkOrder.status == "started"
    work - -> oper: [false, Error("work order has already been started")]    

else newWorkOrder.status == "started" &&\n currentWorkOrder.status == "completed"
    work - -> oper: [false, Error("work order has already been completed")]    

else newWorkOrder.status == "started"
    work -> noti: Push(newWorkOrder.id,\n newWorkOrder.status, newWorkOrder.operatorId)
    activate noti

    work -> db: Change(newWorkOrder)
    activate db

    db - -> work: ok
    deactivate db

    noti - -> work: ok
    deactivate noti

    work - -> oper: true
    deactivate work

    hnote over work: previousWorkOrder = currentWorkOrder
    work -> work: LaunchThreadCheck\n(previousWorkOrder, 30)
    activate work

end

...**Less than 30 seconds**...

super -> work: ChangeStatus(stoppedWorkOrder)
note right: lock thread for stoppedWorkOrder.id
activate work

work -> db: Get(stoppedWorkOrder.id)
activate db

db - -> work: currentWorkOrder
deactivate db

alt stoppedWorkOrder.status == "stopped" &&\n currentWorkOrder.status != "started"
    work - -> super: [false, Error("work order was not started")]    

else stoppedWorkOrder.status == "stopped" &&\n (stoppedWorkOrder.operator != currentWorkOrder.operator ||\n !stoppedWorkOrder.isSupervisor)
    work - -> super: [false, Error("invalid operator")]    

else stoppedWorkOrder.status == "stopped"
    work -> noti: push(stoppedWorkOrder.id,\n stoppedWorkOrder.status, stoppedWorkOrder.operatorId)
    activate noti

    work -> db: Change(stoppedWorkOrder)
    activate db

    db - -> work: ok
    deactivate db

    noti - -> work: ok
    deactivate noti

    work - -> super: true
    deactivate work
end

...**After 30 seconds**...
note right work: lock thread for previousWorkOrder.id
work -> db: Get(previousWorkOrder.id)
activate db

db - -> work: currentWorkOrder
deactivate db

alt currentWorkOrder.status == "started"
    work -> noti: push(previousWorkOrder.id,\n previousWorkOrder.status, previousWorkOrder.operatorId)
    activate noti

    work -> db: Change(previousWorkOrder)
    activate db

    db - -> work: ok
    deactivate db

    noti - -> work: ok
    deactivate noti
    deactivate work
end

@enduml

PlantUML version 1.2020.18(Thu Oct 01 05:40:44 AEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>