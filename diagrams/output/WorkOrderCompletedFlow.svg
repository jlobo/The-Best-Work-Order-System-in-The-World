<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1484px" preserveAspectRatio="none" style="width:949px;height:1484px;" version="1.1" viewBox="0 0 949 1484" width="949px" zoomAndPan="magnify"><defs><filter height="300%" id="f5q6mcjrhc0t" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="209" x="368.25" y="28.708">Work Order Completed</text><rect fill="#FFFFFF" height="1437.4609" style="stroke: #383838; stroke-width: 1.0;" width="322" x="384.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="488.5" y="53.02">Work Order Api</text><rect fill="#FFFFFF" height="1437.4609" style="stroke: #383838; stroke-width: 1.0;" width="120" x="818.5" y="40.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="114" x="821.5" y="53.02">Notification Api</text><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="359.4844" style="stroke: #383838; stroke-width: 1.0;" width="10" x="429.5" y="174.8125"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="20" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="429.5" y="619.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="439.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="439.5" y1="619.6953" y2="619.6953"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="400.6172" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="429.5" y="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="680.5" y2="1081.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="439.5" y1="680.5" y2="1081.1172"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="245.1953" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="429.5" y="1121.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="1121.9219" y2="1367.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="439.5" y1="1121.9219" y2="1367.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="439.5" y1="1367.1172" y2="1367.1172"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="359.4844" style="stroke: #383838; stroke-width: 1.0;" width="10" x="434.5" y="706.6328"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="208.9453"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="446.8984"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="740.7656"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="978.7188"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="1182.1875"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="1308.8516"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="873.5" y="417.7656"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="873.5" y="949.5859"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="873.5" y="1279.7188"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="379.6172" style="stroke: #000000; stroke-width: 2.0;" width="925.5" x="10" y="253.0781"/><rect fill="#FFFFFF" height="56.7422" style="stroke: none; stroke-width: 1.0;" width="925.5" x="10" y="309.9531"/><rect fill="#FFFFFF" height="266" style="stroke: none; stroke-width: 1.0;" width="925.5" x="10" y="366.6953"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="289.2188" style="stroke: #000000; stroke-width: 2.0;" width="925.5" x="10" y="784.8984"/><rect fill="#FFFFFF" height="56.7422" style="stroke: none; stroke-width: 1.0;" width="925.5" x="10" y="841.7734"/><rect fill="#FFFFFF" height="175.6016" style="stroke: none; stroke-width: 1.0;" width="925.5" x="10" y="898.5156"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="148.7969" style="stroke: #000000; stroke-width: 2.0;" width="557" x="378.5" y="1226.3203"/><line style="stroke: #383838; stroke-width: 1.0;" x1="53" x2="53" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="53" x2="53" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="53" x2="53" y1="680.5" y2="1081.1172"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="53" x2="53" y1="1081.1172" y2="1121.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="53" x2="53" y1="1121.9219" y2="1392.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="434.5" x2="434.5" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="434.5" x2="434.5" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="434.5" x2="434.5" y1="680.5" y2="1081.1172"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="434.5" x2="434.5" y1="1081.1172" y2="1121.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="434.5" x2="434.5" y1="1121.9219" y2="1392.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="680.5" y2="1081.1172"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="662.5" x2="662.5" y1="1081.1172" y2="1121.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="662.5" x2="662.5" y1="1121.9219" y2="1392.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="878.5" x2="878.5" y1="138.6797" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="878.5" x2="878.5" y1="639.6953" y2="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="878.5" x2="878.5" y1="680.5" y2="1081.1172"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 1.0,4.0;" x1="878.5" x2="878.5" y1="1081.1172" y2="1121.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="878.5" x2="878.5" y1="1121.9219" y2="1392.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="20" y="135.3779">Operator</text><ellipse cx="53.5" cy="65.3828" fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M53.5,73.3828 L53.5,100.3828 M40.5,81.3828 L66.5,81.3828 M53.5,100.3828 L40.5,115.3828 M53.5,100.3828 L66.5,115.3828 " fill="none" filter="url(#f5q6mcjrhc0t)" style="stroke: #383838; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="20" y="1404.1123">Operator</text><ellipse cx="53.5" cy="1417.4141" fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" rx="8" ry="8" style="stroke: #383838; stroke-width: 2.0;"/><path d="M53.5,1425.4141 L53.5,1452.4141 M40.5,1433.4141 L66.5,1433.4141 M53.5,1452.4141 L40.5,1467.4141 M53.5,1452.4141 L66.5,1467.4141 " fill="none" filter="url(#f5q6mcjrhc0t)" style="stroke: #383838; stroke-width: 2.0;"/><rect fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="88" x="388.5" y="87.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="395.5" y="107.0811">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="399" y="123.3779">Controller</text><rect fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="88" x="388.5" y="1391.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="395.5" y="1411.1123">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="399" y="1427.4092">Controller</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="622.5" y="119.0811">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="622.5" y="135.3779">Repository</text><path d="M644.5,70.0859 C644.5,60.0859 662.5,60.0859 662.5,60.0859 C662.5,60.0859 680.5,60.0859 680.5,70.0859 L680.5,96.0859 C680.5,106.0859 662.5,106.0859 662.5,106.0859 C662.5,106.0859 644.5,106.0859 644.5,96.0859 L644.5,70.0859 " fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M644.5,70.0859 C644.5,80.0859 662.5,80.0859 662.5,80.0859 C662.5,80.0859 680.5,80.0859 680.5,70.0859 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="622.5" y="1404.1123">WorkOrder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="74" x="622.5" y="1420.4092">Repository</text><path d="M644.5,1433.7109 C644.5,1423.7109 662.5,1423.7109 662.5,1423.7109 C662.5,1423.7109 680.5,1423.7109 680.5,1433.7109 L680.5,1459.7109 C680.5,1469.7109 662.5,1469.7109 662.5,1469.7109 C662.5,1469.7109 644.5,1469.7109 644.5,1459.7109 L644.5,1433.7109 " fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M644.5,1433.7109 C644.5,1443.7109 662.5,1443.7109 662.5,1443.7109 C662.5,1443.7109 680.5,1443.7109 680.5,1433.7109 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><rect fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="90" x="831.5" y="87.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="838.5" y="107.0811">Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="843" y="123.3779">Controller</text><rect fill="#F8F8F8" filter="url(#f5q6mcjrhc0t)" height="46.5938" style="stroke: #383838; stroke-width: 1.5;" width="90" x="831.5" y="1391.1172"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="76" x="838.5" y="1411.1123">Notification</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="67" x="843" y="1427.4092">Controller</text><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="359.4844" style="stroke: #383838; stroke-width: 1.0;" width="10" x="429.5" y="174.8125"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="20" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="429.5" y="619.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="439.5" y1="619.6953" y2="639.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="439.5" y1="619.6953" y2="619.6953"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="400.6172" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="429.5" y="680.5"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="680.5" y2="1081.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="439.5" y1="680.5" y2="1081.1172"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="245.1953" style="stroke: #FFFFFF; stroke-width: 1.0;" width="10" x="429.5" y="1121.9219"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="429.5" y1="1121.9219" y2="1367.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="439.5" y1="1121.9219" y2="1367.1172"/><line style="stroke: #383838; stroke-width: 1.0;" x1="429.5" x2="439.5" y1="1367.1172" y2="1367.1172"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="359.4844" style="stroke: #383838; stroke-width: 1.0;" width="10" x="434.5" y="706.6328"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="208.9453"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="446.8984"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="740.7656"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="978.7188"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="1182.1875"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="29.1328" style="stroke: #383838; stroke-width: 1.0;" width="10" x="657.5" y="1308.8516"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="873.5" y="417.7656"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="873.5" y="949.5859"/><rect fill="#FFFFFF" filter="url(#f5q6mcjrhc0t)" height="87.3984" style="stroke: #383838; stroke-width: 1.0;" width="10" x="873.5" y="1279.7188"/><polygon fill="#383838" points="417.5,170.8125,427.5,174.8125,417.5,178.8125,421.5,174.8125" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="53.5" x2="423.5" y1="174.8125" y2="174.8125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="193" x="60.5" y="169.7466">ChangeStatus(newWorkOrder)</text><path d="M444,153.6797 L444,178.6797 L668,178.6797 L668,163.6797 L658,153.6797 L444,153.6797 " fill="#ECECEC" filter="url(#f5q6mcjrhc0t)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M658,153.6797 L658,163.6797 L668,163.6797 L658,153.6797 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="450" y="170.7466">lock thread for newWorkOrder.id</text><polygon fill="#383838" points="645.5,204.9453,655.5,208.9453,645.5,212.9453,649.5,208.9453" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="651.5" y1="208.9453" y2="208.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="446.5" y="203.8794">Get(newWorkOrder.id)</text><polygon fill="#383838" points="450.5,234.0781,440.5,238.0781,450.5,242.0781,446.5,238.0781" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="444.5" x2="661.5" y1="238.0781" y2="238.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="456.5" y="233.0122">currentWorkOrder</text><path d="M10,253.0781 L74,253.0781 L74,260.0781 L64,270.0781 L10,270.0781 L10,253.0781 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="379.6172" style="stroke: #000000; stroke-width: 2.0;" width="925.5" x="10" y="253.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="25" y="266.145">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="89" y="265.2886">[newWorkOrder.status == "started" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="248" x="93" y="278.0933">currentWorkOrder.status == "started"]</text><polygon fill="#383838" points="64.5,297.9531,54.5,301.9531,64.5,305.9531,60.5,301.9531" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58.5" x2="428.5" y1="301.9531" y2="301.9531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="330" x="70.5" y="296.8872">[false, Error("work order has already been started")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="935.5" y1="310.9531" y2="310.9531"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="15" y="321.1636">[newWorkOrder.status == "started" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="269" x="19" y="333.9683">currentWorkOrder.status == "completed"]</text><polygon fill="#383838" points="64.5,354.6953,54.5,358.6953,64.5,362.6953,60.5,358.6953" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58.5" x2="428.5" y1="358.6953" y2="358.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="70.5" y="353.6294">[false, Error("work order has already been completed")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="935.5" y1="367.6953" y2="367.6953"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="234" x="15" y="377.9058">[newWorkOrder.status == "started"]</text><polygon fill="#383838" points="861.5,413.7656,871.5,417.7656,861.5,421.7656,865.5,417.7656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="867.5" y1="417.7656" y2="417.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="147" x="446.5" y="397.5669">Push(newWorkOrder.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="450.5" y="412.6997">newWorkOrder.status, newWorkOrder.operatorId)</text><polygon fill="#383838" points="645.5,442.8984,655.5,446.8984,645.5,450.8984,649.5,446.8984" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="651.5" y1="446.8984" y2="446.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="446.5" y="441.8325">Change(newWorkOrder)</text><polygon fill="#383838" points="450.5,472.0313,440.5,476.0313,450.5,480.0313,446.5,476.0313" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="444.5" x2="661.5" y1="476.0313" y2="476.0313"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="456.5" y="470.9653">ok</text><polygon fill="#383838" points="450.5,501.1641,440.5,505.1641,450.5,509.1641,446.5,505.1641" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="444.5" x2="877.5" y1="505.1641" y2="505.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="456.5" y="500.0981">ok</text><polygon fill="#383838" points="64.5,530.2969,54.5,534.2969,64.5,538.2969,60.5,534.2969" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58.5" x2="433.5" y1="534.2969" y2="534.2969"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="70.5" y="529.231">true</text><polygon fill="#ECECEC" filter="url(#f5q6mcjrhc0t)" points="306,547.2969,563,547.2969,573,558.2969,563,570.2969,306,570.2969,296,558.2969,306,547.2969" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="308" y="563.3638">previousWorkOrder = currentWorkOrder</text><line style="stroke: #383838; stroke-width: 1.0;" x1="434.5" x2="481.5" y1="606.6953" y2="606.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="481.5" x2="481.5" y1="606.6953" y2="619.6953"/><line style="stroke: #383838; stroke-width: 1.0;" x1="440.5" x2="481.5" y1="619.6953" y2="619.6953"/><polygon fill="#383838" points="450.5,615.6953,440.5,619.6953,450.5,623.6953,446.5,619.6953" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="129" x="446.5" y="586.4966">LaunchThreadCheck</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="155" x="446.5" y="601.6294">(previousWorkOrder, 30)</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="139" x="396.5" y="663.9058">Less than 30 seconds</text><polygon fill="#383838" points="422.5,702.6328,432.5,706.6328,422.5,710.6328,426.5,706.6328" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="53.5" x2="428.5" y1="706.6328" y2="706.6328"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="236" x="60.5" y="701.5669">ChangeStatus(completedWorkOrder)</text><path d="M449,685.5 L449,710.5 L716,710.5 L716,695.5 L706,685.5 L449,685.5 " fill="#ECECEC" filter="url(#f5q6mcjrhc0t)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M706,685.5 L706,695.5 L716,695.5 L706,685.5 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="246" x="455" y="702.5669">lock thread for completedWorkOrder.id</text><polygon fill="#383838" points="645.5,736.7656,655.5,740.7656,645.5,744.7656,649.5,740.7656" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="444.5" x2="651.5" y1="740.7656" y2="740.7656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="183" x="451.5" y="735.6997">Get(completedWorkOrder.id)</text><polygon fill="#383838" points="455.5,765.8984,445.5,769.8984,455.5,773.8984,451.5,769.8984" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="449.5" x2="661.5" y1="769.8984" y2="769.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="461.5" y="764.8325">currentWorkOrder</text><path d="M10,784.8984 L74,784.8984 L74,791.8984 L64,801.8984 L10,801.8984 L10,784.8984 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="289.2188" style="stroke: #000000; stroke-width: 2.0;" width="925.5" x="10" y="784.8984"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="25" y="797.9653">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="314" x="89" y="797.1089">[completedWorkOrder.status == "completed" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="244" x="93" y="809.9136">currentWorkOrder.status != "started"]</text><polygon fill="#383838" points="64.5,829.7734,54.5,833.7734,64.5,837.7734,60.5,833.7734" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58.5" x2="433.5" y1="833.7734" y2="833.7734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="70.5" y="828.7075">[false, Error("work order was not started")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="935.5" y1="842.7734" y2="842.7734"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="314" x="15" y="852.9839">[completedWorkOrder.status == "completed" &amp;&amp;</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="396" x="19" y="865.7886">completedWorkOrder.operator != currentWorkOrder.operator]</text><polygon fill="#383838" points="64.5,886.5156,54.5,890.5156,64.5,894.5156,60.5,890.5156" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58.5" x2="433.5" y1="890.5156" y2="890.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="198" x="70.5" y="885.4497">[false, Error("invalid operator")]</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="935.5" y1="899.5156" y2="899.5156"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="295" x="15" y="909.7261">[completedWorkOrder.status == "completed"]</text><polygon fill="#383838" points="861.5,945.5859,871.5,949.5859,861.5,953.5859,865.5,949.5859" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="444.5" x2="867.5" y1="949.5859" y2="949.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="190" x="451.5" y="929.3872">push(completedWorkOrder.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="397" x="455.5" y="944.52">completedWorkOrder.status, completedWorkOrder.operatorId)</text><polygon fill="#383838" points="645.5,974.7188,655.5,978.7188,645.5,982.7188,649.5,978.7188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="444.5" x2="651.5" y1="978.7188" y2="978.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="194" x="451.5" y="973.6528">Change(completedWorkOrder)</text><polygon fill="#383838" points="455.5,1003.8516,445.5,1007.8516,455.5,1011.8516,451.5,1007.8516" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="449.5" x2="661.5" y1="1007.8516" y2="1007.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="461.5" y="1002.7856">ok</text><polygon fill="#383838" points="455.5,1032.9844,445.5,1036.9844,455.5,1040.9844,451.5,1036.9844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="449.5" x2="877.5" y1="1036.9844" y2="1036.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="461.5" y="1031.9185">ok</text><polygon fill="#383838" points="64.5,1062.1172,54.5,1066.1172,64.5,1070.1172,60.5,1066.1172" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="58.5" x2="428.5" y1="1066.1172" y2="1066.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="26" x="70.5" y="1061.0513">true</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="412" y="1105.3276">After 30 seconds</text><path d="M444,1126.9219 L444,1151.9219 L697,1151.9219 L697,1136.9219 L687,1126.9219 L444,1126.9219 " fill="#ECECEC" filter="url(#f5q6mcjrhc0t)" style="stroke: #383838; stroke-width: 1.0;"/><path d="M687,1126.9219 L687,1136.9219 L697,1136.9219 L687,1126.9219 " fill="#ECECEC" style="stroke: #383838; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="450" y="1143.9888">lock thread for previousWorkOrder.id</text><polygon fill="#383838" points="645.5,1178.1875,655.5,1182.1875,645.5,1186.1875,649.5,1182.1875" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="651.5" y1="1182.1875" y2="1182.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="169" x="446.5" y="1177.1216">Get(previousWorkOrder.id)</text><polygon fill="#383838" points="450.5,1207.3203,440.5,1211.3203,450.5,1215.3203,446.5,1211.3203" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="444.5" x2="661.5" y1="1211.3203" y2="1211.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="456.5" y="1206.2544">currentWorkOrder</text><path d="M378.5,1226.3203 L442.5,1226.3203 L442.5,1233.3203 L432.5,1243.3203 L378.5,1243.3203 L378.5,1226.3203 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="148.7969" style="stroke: #000000; stroke-width: 2.0;" width="557" x="378.5" y="1226.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="393.5" y="1239.3872">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="253" x="457.5" y="1238.5308">[currentWorkOrder.status == "started"]</text><polygon fill="#383838" points="861.5,1275.7188,871.5,1279.7188,861.5,1283.7188,865.5,1279.7188" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="867.5" y1="1279.7188" y2="1279.7188"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="176" x="446.5" y="1259.52">push(previousWorkOrder.id,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="369" x="450.5" y="1274.6528">previousWorkOrder.status, previousWorkOrder.operatorId)</text><polygon fill="#383838" points="645.5,1304.8516,655.5,1308.8516,645.5,1312.8516,649.5,1308.8516" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0;" x1="439.5" x2="651.5" y1="1308.8516" y2="1308.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="446.5" y="1303.7856">Change(previousWorkOrder)</text><polygon fill="#383838" points="450.5,1333.9844,440.5,1337.9844,450.5,1341.9844,446.5,1337.9844" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="444.5" x2="661.5" y1="1337.9844" y2="1337.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="456.5" y="1332.9185">ok</text><polygon fill="#383838" points="445.5,1363.1172,435.5,1367.1172,445.5,1371.1172,441.5,1367.1172" style="stroke: #383838; stroke-width: 1.0;"/><line style="stroke: #383838; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="439.5" x2="877.5" y1="1367.1172" y2="1367.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="15" x="451.5" y="1362.0513">ok</text><!--MD5=[be50fd47d8e51e33dd3b9b348ec2ffb6]
@startuml WorkOrderCompletedFlow
title Work Order Completed
skinparam monochrome true

actor Operator as oper

box "Work Order Api" #Withe
participant "WorkOrder\nController" as work
database "WorkOrder\nRepository" as db
end box

box "Notification Api" #Withe
participant "Notification\nController" as noti
end box

oper -> work: ChangeStatus(newWorkOrder)
note right: lock thread for newWorkOrder.id
activate work

work -> db: Get(newWorkOrder.id)
activate db

db - -> work: currentWorkOrder
deactivate db

alt newWorkOrder.status == "started" &&\n currentWorkOrder.status == "started"
    work - -> oper: [false, Error("work order has already been started")]    

else newWorkOrder.status == "started" &&\n currentWorkOrder.status == "completed"
    work - -> oper: [false, Error("work order has already been completed")]    

else newWorkOrder.status == "started"
    work -> noti: Push(newWorkOrder.id,\n newWorkOrder.status, newWorkOrder.operatorId)
    activate noti

    work -> db: Change(newWorkOrder)
    activate db

    db - -> work: ok
    deactivate db

    noti - -> work: ok
    deactivate noti

    work - -> oper: true
    deactivate work

    hnote over work: previousWorkOrder = currentWorkOrder
    work -> work: LaunchThreadCheck\n(previousWorkOrder, 30)
    activate work

end

...**Less than 30 seconds**...

oper -> work: ChangeStatus(completedWorkOrder)
note right: lock thread for completedWorkOrder.id
activate work

work -> db: Get(completedWorkOrder.id)
activate db

db - -> work: currentWorkOrder
deactivate db

alt completedWorkOrder.status == "completed" &&\n currentWorkOrder.status != "started"
    work - -> oper: [false, Error("work order was not started")]    

else completedWorkOrder.status == "completed" &&\n completedWorkOrder.operator != currentWorkOrder.operator
    work - -> oper: [false, Error("invalid operator")]    

else completedWorkOrder.status == "completed"
    work -> noti: push(completedWorkOrder.id,\n completedWorkOrder.status, completedWorkOrder.operatorId)
    activate noti

    work -> db: Change(completedWorkOrder)
    activate db

    db - -> work: ok
    deactivate db

    noti - -> work: ok
    deactivate noti

    work - -> oper: true
    deactivate work
end

...**After 30 seconds**...
note right work: lock thread for previousWorkOrder.id
work -> db: Get(previousWorkOrder.id)
activate db

db - -> work: currentWorkOrder
deactivate db

alt currentWorkOrder.status == "started"
    work -> noti: push(previousWorkOrder.id,\n previousWorkOrder.status, previousWorkOrder.operatorId)
    activate noti

    work -> db: Change(previousWorkOrder)
    activate db

    db - -> work: ok
    deactivate db

    noti - -> work: ok
    deactivate noti
    deactivate work
end

@enduml

PlantUML version 1.2020.18(Thu Oct 01 05:40:44 AEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: AU
--></g></svg>